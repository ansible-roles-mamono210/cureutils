---
- name: Check whether Cureutils command is installed
  ansible.builtin.command: cure version
  register: cureutils_installed
  failed_when: false
  changed_when: false
  environment:
    RUBYOPT: -EUTF-8
    PATH: "/usr/local/bin:{{ ansible_env.PATH }}"

- name: Install Bundler
  community.general.gem:
    name: bundler
    state: latest
    user_install: no
  when: cureutils_installed.msg is search("No such file or directory")

- name: Update gem
  ansible.builtin.command: gem update --system
  when: cureutils_installed.msg is search("No such file or directory")

- name: Install Cureutils
  community.general.gem:
    name: cureutils
    state: present
    user_install: no
  when: cureutils_installed.msg is search("No such file or directory")
